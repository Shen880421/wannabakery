<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>購物車</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../src/css/CSS_reset.css">
    <!-- 字型 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Just+Me+Again+Down+Here&family=LXGW+WenKai+Mono+TC&family=Shadows+Into+Light&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC&display=swap" rel="stylesheet">
    <!-- 字型 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <link rel="stylesheet" href="../src/css/wannabakery.css">
    <style>
        /*增加產品被選擇時的明顯狀態*/
        .prod-card.selected {
            border-color: #B6C4CE;
            background-color: #DDEBE5;
        }
    </style>
</head>

<body>
    <nav class="container-fuid nav_top">
        <div class="row col-12">
            <div class="row nav_logoname col-4">
                <div class="col-5 nav_logoimg">
                    <img src="../src/img/wannabakerylogo.jpg" class="logo_size">
                </div>
                <div class="col-7 text-start">
                    <div class="bakeryname">Wannabakery</div>
                </div>
            </div>
            <div class="col-8 text-end nav_button">
                <a href="wannabakery.html" role="button" type="button" class="btn btn_customcolor" autocomplete="off"
                    aria-pressed="true">首頁</a>
                <a href="../index.html" role="button" type="button" class="btn btn_customcolor"
                    autocomplete="off">聯絡我們</a>
                <a role="button" type="button" class="btn btn_customcolor" autocomplete="off">產品介紹</a>
                <a href="bakerycart.html" type="button" role="button" class="btn btn_customcolor active"
                    autocomplete="off">購物車</a>
            </div>
        </div>
    </nav>
    <form id="orderform" class="needs-validation" novalidate>
        <!--產品資訊區塊及頁面標題-->
        <section class="container mt-4">
            <h1 class="text-center">購物車</h1>

            <!-- <div class="alert alert-info alert-dismissible fade show" role="alert">
                <strong>提醒：</strong> 請確認以下欄位是否正確。
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="關閉"></button>
            </div> -->
            <div class="card">
                <div class="card-header mint">
                    <h4>選擇產品</h4>
                </div>
                <div class="card-body">
                    <div class="row row-cols-1 row-cols-md-3 " id=productList>

                    </div>
                    <div class="form-check mt-1">
                        <input type="checkbox" class="form-check-input" id="warranty">
                        <label for="warranty" class="form-check-lable">禮盒包裝服務 +NT$100</label>
                        <div class="text-end"><br>甜點皆需冷凍/藏宅配 運費+NT$80</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <h2>🛒 購物車</h2>
                <ul id="cartList"></ul>
                <p><strong>總金額：</strong><span id="total">0</span> 元</p>
            </div>

        </section>
        <!--消費者資訊-->
        <section class="container mt-4">
            <div class="row">
                <div class="col-12 col-md-6">
                    <div class="card">
                        <div class="card-header mint">客戶資訊</div>
                        <div class="card-body">
                            <div class="cname-div">
                                <label for="cname" class="form-check-label">購買人姓名</label>
                                <input id="cname" name="canme" class="form-control" required>
                                <div class="invalid-feedback">
                                    請輸入您的姓名
                                </div>
                            </div>
                            <div class="cemail-div mt-2">
                                <label for="cemail" class="form-check-label">購買人電郵</label>
                                <input id="cemail" name="cemail" class="form-control" required>
                                <div class="invalid-feedback">
                                    請輸入您的email
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="card">
                        <div class="card-header mint">配送資訊</div>
                        <div class="card-body">
                            <div class="city-div">
                                <label for="ccity" class="form-check-label">縣市</label>
                                <select class="form-select" id="ccity" name="ccity" onchange="updateDistricts()"
                                    required>
                                    <option value="">---請選擇---</option>
                                </select>
                                <div class="invalid-feedback">請選擇縣市</div>
                            </div>

                            <div class="district-div mt-2">
                                <label for="cdistrict" class="form-check-label">行政區域</label>
                                <select id="cdistrict" name="cdistrict" class="form-select" required>
                                    <option value="">---請先選擇縣市---</option>
                                </select>
                                <div class="invalid-feedback">請選擇行政區</div>
                            </div>

                            <div class="caddr-div mt-2">
                                <label for="caddr" class="form-check-label">地址</label>
                                <input id="caddr" name="caddr" class="form-control" required>
                                <div class="invalid-feedback">請輸入您的地址路名門牌</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!--付款方式-->
        <section class="container mt-4">
            <div class="card">
                <div class="card-header mint">支付方式</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <!--信用卡支付工具-->
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="creditcard"
                                    value="creditcard">
                                <label class="form-check-label" for="creditcard">信用卡/Debit卡</label>
                            </div>
                            <div class="cardnumber-info">
                                <label>卡號</label>
                                <input type="text" class="form-control" id="cardNumber" name="cardNumber"
                                    placeholder="xxxx xxxx xxxx xxxx">
                            </div>
                            <div class="card-info mt-4">
                                <div class="row">
                                    <div class="col-12 col-md-6">
                                        <label for="exDate" class="form-label">到期月/年</label>
                                        <input type="text" class="form-control" id="exDate" name="exDate"
                                            placeholder="MM/YY">
                                        <div class="invalid-feedback">
                                            信用卡卡號需要輸入
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label for="cvv" class="form-label">cvv</label>
                                        <input class="form-control" type="text" id="cvv" name="cvv">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <!--其他支付工具-->
                            <div class="mt-4">
                                <input type="radio" id="linepay" name="paymentMethod" value="linepay" checked>
                                <label for="linepay" class="form-check-label">LinePay</label>
                            </div>
                            <div class="mt-4">
                                <input type="radio" id="atm" name="paymentMethod" value="atm">
                                <label for="atm" class="form-check-label">ATM</label>
                            </div>
                            <div class="mt-4">
                                <input type="radio" id="cod" name="paymentMethod" value="cod">
                                <label for="cod" class="form-check-label">貨到付款</label>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
        <!--訂單明細-->
        <section class="container mt-4">
            <div class="card">
                <div class="card-header mint">訂單摘要</div>
                <div class="card-body">
                    <div class="order-summary">
                        <div class="row mt-2">
                            <div class="col-7">禮盒包裝服務</div>
                            <div class="col-5 text-end" id="warrantyPrice">不需包裝</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-7">運費</div>
                            <div class="col-5 text-end" id="shippingfee">冷藏/凍運費NT$80</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-7">總計</div>
                            <div class="col-5 text-end" id="ALLtotalPrice">NT$0</div>
                        </div>
                    </div>
                    <div class="form-check mt-2">
                        <input type="checkbox" class="form-check-input" id="term" name="term" required>
                        <label for="term" class="form-check-label">
                            我已閱讀且同意<a href="javascript:;">服務條款</a>及<a href="javascript:;">隱私政策</a>
                        </label>
                        <div class="invalid-feedback">您必須同意才能進行結帳.</div>
                    </div>
                    <div class="mt-2 d-grid">
                        <button type="submit" class="btn btn_customcolor btn-lg">結帳</button>
                    </div>
                </div>

            </div>
            </div>
        </section>

    </form>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>/*縣市區域*/
        let addressData = []; // 用來存放API資料

        async function loadAddressData() {
            try {
                const response = await fetch("../src/data/CityCountyData.json"); // 請換成你真正的API URL
                addressData = await response.json();

                const citySelect = document.getElementById("ccity");

                // 將所有縣市加入下拉選單
                addressData.forEach(city => {
                    const option = document.createElement("option");
                    option.value = city.CityName;
                    option.textContent = city.CityName;
                    citySelect.appendChild(option);
                });
            } catch (error) {
                console.error("載入縣市資料錯誤:", error);
            }
        }

        function updateDistricts() {
            const citySelect = document.getElementById("ccity");
            const districtSelect = document.getElementById("cdistrict");
            const selectedCity = citySelect.value;

            // 清空行政區選單
            districtSelect.innerHTML = '<option value="">---請選擇行政區---</option>';

            if (!selectedCity) return;

            // 找到選中的縣市資料
            const cityData = addressData.find(city => city.CityName === selectedCity);

            if (cityData) {
                cityData.AreaList.forEach(area => {
                    const option = document.createElement("option");
                    option.value = area.AreaName;
                    option.textContent = area.AreaName;
                    districtSelect.appendChild(option);
                });
            }
        }

        // 頁面載入時執行
        window.addEventListener("DOMContentLoaded", loadAddressData);
    </script>
    <script>
        const productList = document.getElementById('productList');
        const cartList = document.getElementById('cartList');
        const total = document.getElementById('total');
        let cart = [];

        // 🔁 從 JSON 檔案載入商品資料
        fetch('../src/data/products.json')
            .then(res => res.json())
            .then(data => {
                data.forEach(product => {
                    const div = document.createElement('div');
                    div.className = 'product';
                    div.innerHTML = `
          <img src="${product.image_url}" width="100"><br>
          <h3>${product.name}</h3>
          <p>價格：${product.price} 元</p>
          <button type ="button" onclick='addToCart(${JSON.stringify(product)})'>加入購物車</button>
        `;
                    productList.appendChild(div);
                });
            });

        function addToCart(product) {
            const existing = cart.find(item => item.id === product.id);
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            renderCart();
        }

        function renderCart() {
            cartList.innerHTML = '';
            let totalPrice = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);


            cart.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
        ${item.name} x ${item.quantity} = ${item.price * item.quantity} 元
        <button type ="button" onclick="increaseQuantity(${index})">＋</button>
        <button type ="button" onclick="decreaseQuantity(${index})">－</button>
        <button type ="button" onclick="removeItem(${index})">移除</button>
      `;
                cartList.appendChild(li);
                totalPrice += item.price * item.quantity;
            });

            let warrantyFee = document.getElementById('warranty').checked ? 100 : 0;
            let shippingFee = 80; 
            total.textContent = (totalPrice).toFixed(2);
            document.getElementById('warrantyPrice').textContent = warrantyFee ? 'NT$100' : '不需包裝';
            document.getElementById('ALLtotalPrice').textContent = `NT$${(totalPrice + warrantyFee + shippingFee).toFixed(2)}`;
        }

        function increaseQuantity(index) {
            cart[index].quantity++;
            renderCart();
        }

        function decreaseQuantity(index) {
            if (cart[index].quantity > 1) {
                cart[index].quantity--;
            } else {
                removeItem(index);
            }
            renderCart();
        }

        function removeItem(index) {
            cart.splice(index, 1);
            renderCart();
        }
        document.getElementById('warranty').addEventListener('change', renderCart);
    </script>

</body>

</html>